<Window x:Class="TinyUnrealPackerExtended.ShellWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:vm="clr-namespace:TinyUnrealPackerExtended.ViewModels"
        xmlns:vmExt="clr-namespace:TinyUnrealPackerExtended.ViewModels.Pages"
        xmlns:pages="clr-namespace:TinyUnrealPackerExtended.Views.Pages"
        xmlns:conv="clr-namespace:TinyUnrealPackerExtended.Converters"
        Title="Settings"
        Width="900"
        Height="550"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent">

    <!-- Converters & fade-in style -->
    <Window.Resources>
        <conv:TypeToBooleanConverter x:Key="TypeToBooleanConverter" />

        <Style TargetType="ContentControl">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ContentControl">
                        <ContentPresenter x:Name="P"
                                          Content="{TemplateBinding Content}"
                                          Opacity="0" />
                        <ControlTemplate.Triggers>
                            <EventTrigger RoutedEvent="ContentPresenter.Loaded"
                                          SourceName="P">
                                <BeginStoryboard>
                                    <Storyboard>
                                        <DoubleAnimation Storyboard.TargetName="P"
                                                         Storyboard.TargetProperty="Opacity"
                                                         From="0"
                                                         To="1"
                                                         Duration="0:0:0.3" />
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Window.DataContext>
        <vm:ShellViewModel />
    </Window.DataContext>

    <Border CornerRadius="8"
            Background="{DynamicResource WindowBackgroundBrush}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <!-- Title bar -->
                <RowDefinition Height="*" />
                <!-- Main content -->
                <RowDefinition Height="Auto" />
                <!-- Bottom bar -->
            </Grid.RowDefinitions>

            <!-- TITLE BAR -->
            <Grid Grid.Row="0"
                  Background="Transparent"
                  MouseLeftButtonDown="TitleBar_MouseDown">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Cog + "Settings" -->
                <StackPanel Orientation="Horizontal"
                            VerticalAlignment="Center"
                            Margin="12,0">
                    <iconPacks:PackIconMaterial Kind="Cog"
                                                Width="18"
                                                Height="24"
                                                Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="Настройки"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="8,0" />
                </StackPanel>

                <!-- Close button -->
                <StackPanel Orientation="Horizontal"
                            Grid.Column="2"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Top">
                    <Button Style="{StaticResource NavigationButtonStyle}"
                            Click="CloseWindow_Click">
                        <iconPacks:PackIconMaterial Kind="Close"
                                                    Width="16"
                                                    Height="16" />
                    </Button>
                </StackPanel>
            </Grid>

            <!-- MAIN AREA -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150" />
                    <ColumnDefinition Width="4" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- SIDEBAR -->
                <Border Grid.Column="0"
                        Background="{DynamicResource SettingsCardBackgroundBrush}"
                        CornerRadius="8"
                        Padding="10"
                        Margin="12,12,0,12">
                    <StackPanel>
                        <ToggleButton Style="{StaticResource SidebarItemStyle}"
                                      Command="{Binding ShowThemesCommand}"
                                      IsChecked="{Binding CurrentViewModel,
                                                     Mode=OneWay,
                                                     Converter={StaticResource TypeToBooleanConverter},
                                                     ConverterParameter={x:Type vmExt:ThemesViewModel}}"
                                      HorizontalContentAlignment="Center"
                                      VerticalContentAlignment="Center">
                            <StackPanel Orientation="Horizontal">
                                <iconPacks:PackIconMaterial Kind="Palette"
                                                            Width="20"
                                                            Height="24"
                                                            Margin="0,0,8,0" />
                                <TextBlock Text="Темы"
                                           FontSize="15"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </ToggleButton>
                        <!-- другие пункты... -->
                    </StackPanel>
                </Border>

                <!-- SPLITTER -->
                <GridSplitter Grid.Column="1"
                              Style="{StaticResource SmoothGridSplitterStyle}" />

                <!-- CONTENT -->
                <Border Grid.Column="2"
                        Style="{StaticResource CardStyle}"
                        Background="{DynamicResource SettingsCardBackgroundBrush}"
                        Margin="6,12,12,12">
                    <ContentControl Content="{Binding CurrentViewModel}">
                        <ContentControl.Resources>
                            <DataTemplate DataType="{x:Type vmExt:ThemesViewModel}">
                                <pages:ThemesView />
                            </DataTemplate>
                        </ContentControl.Resources>
                    </ContentControl>
                </Border>
            </Grid>

            <!-- BOTTOM BAR -->
            <Border Grid.Row="2"
                    Background="{DynamicResource CardBackgroundBrush}"
                    CornerRadius="6"
                    Padding="8,8"
                    Margin="12,0,12,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="Для применения изменений перезапустите программу."
                               VerticalAlignment="Center"
                               Margin="8"
                               Foreground="{DynamicResource TextPrimaryBrush}"
                               FontSize="14" />

                    <Button Grid.Column="1"
                            Content="Подтвердить"
                            Command="{Binding SaveSettingsCommand}"
                            Style="{StaticResource PrimaryButtonStyle}"
                            VerticalAlignment="Center"
                            Margin="16,0,0,0" HorizontalAlignment="Right" />
                </Grid>
            </Border>
        </Grid>
    </Border>
</Window>
